//
// Generated by PHiLe v{version}
// Copyright (C) 2017, {authors}
//

package {namespace}

import "gopkg.in/mgo.v2"

type {ctxtype} struct {{
    Session *mgo.Session
    Db      *mgo.Database
}}

func OpenCtx(connStr string) (*{ctxtype}, error) {{
    session, err := mgo.Dial(connStr)
    if err != nil {{
        return nil, err
    }}

    db := session.DB("")
    ctx := &{ctxtype} {{
        Session: session,
        Db:      db,
    }}

    return ctx, nil
}}

func (ctx *{ctxtype}) CloseCtx() {{
    ctx.Session.Close()
    ctx.Db = nil
}}

func (ctx *{ctxtype}) CreateSchema(dropDb bool) error {{
    if dropDb {{
        if err := ctx.Db.DropDatabase(); err != nil {{
            return err
        }}
    }}

    // In MongoDB, collections are created lazily upon first insertion.
    // Therefore, the actual creation of collections is a no-op here.
    return nil
}}

//
// Top-level Queries
//

